<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Election Zone – 2026 Senate Map</title>
  <style>
    /* Overall page styling */
    body {
      margin: 0;
      background: radial-gradient(ellipse at center, #2b2b2b 0%, #121212 100%);
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    /* Logo positioning */
    .logo {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 100px;
      z-index: 10;
    }

    /* Container that holds the SVG map */
    .map-container {
      position: absolute;
      top: 0;
      left: 0;
      right: 300px;
      bottom: 50px;
      overflow: auto;
    }

    /* Sidebar for displaying seat counts and demographics */
    .sidebar {
      position: absolute;
      top: 0;
      right: 0;
      width: 300px;
      height: calc(100% - 50px);
      background-color: #2a2a2a;
      padding: 20px;
      box-sizing: border-box;
    }

    /* Footer styling */
    .footer {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 50px;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Bar showing seat distribution */
    .seat-bar {
      display: flex;
      height: 20px;
      width: 100%;
      margin-top: 20px;
      background: #555;
      border-radius: 4px;
      overflow: hidden;
    }
    .bar-segment {
      height: 100%;
      transition: width 0.5s ease;
    }

    /* Party selector buttons */
    .party-selector {
      position: absolute;
      top: 10px;
      right: 320px;
      z-index: 10;
      display: flex;
      gap: 10px;
    }
    .party-button {
      border: none;
      padding: 6px 12px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px;
      color: white;
    }

    svg path {
      cursor: pointer;
      stroke: #000;
      stroke-width: 1;
    }

    /* Tooltip styling */
    .tooltip {
      position: absolute;
      padding: 5px 10px;
      background: #333;
      color: white;
      border-radius: 4px;
      pointer-events: none;
      font-size: 14px;
      display: none;
      z-index: 100;
    }
  </style>
</head>
<body>
  <!-- Party selector buttons -->
  <div class="party-selector">
    <button class="party-button" data-party="rep" style="background:#d84a4a">Republican</button>
    <button class="party-button" data-party="dem" style="background:#2e74d7">Democrat</button>
    <button class="party-button" data-party="independent" style="background:#4CAF50">Independent</button>
    <button class="party-button" data-party="undecided" style="background:#ccc; color:black">Undecided</button>
  </div>

  <!-- Election Zone logo (placeholder, user can replace with their own) -->
  <img alt="Election Zone Logo" class="logo" src="logo.png">

  <!-- Container for the SVG map -->
  <div class="map-container">
    <div id="us-map">
      <!-- The SVG will be loaded here via fetch -->
    </div>
  </div>

  <!-- Sidebar showing seat counts and controls -->
  <div class="sidebar">
    <div class="seat-bar">
      <div class="bar-segment" id="bar-dem" style="background:#2e74d7; width:0%"></div>
      <div class="bar-segment" id="bar-rep" style="background:#d84a4a; width:0%"></div>
      <div class="bar-segment" id="bar-ind" style="background:#4CAF50; width:0%"></div>
      <div class="bar-segment" id="bar-und" style="background:#ccc; width:100%"></div>
    </div>
    <h2>Senate Seats</h2>
    <div class="ev-count" id="dem-seats">Democrat: 0</div>
    <div class="ev-count" id="rep-seats">Republican: 0</div>
    <div class="ev-count" id="ind-seats">Independent: 0</div>
    <div class="ev-count" id="und-seats">Undecided: 35</div>
    <button onclick="resetMap()">Reset Map</button>
    <button onclick="saveMapState()">Save State</button>
    <button onclick="loadMapState()">Load State</button>
    <button onclick="exportMap()">Export as PNG</button>
    <div id="demographic-info" style="margin-top: 20px;">
      <h3>Demographics</h3>
      <div id="demo-content">Click a state to see demographics.</div>
    </div>
  </div>

  <div class="tooltip" id="tooltip"></div>

  <div class="footer">
    Election Zone © 2025 Mock Simulator
  </div>

  <!-- Include html2canvas for exporting the map to PNG -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    // Mapping of party identifiers to their colours
    const colors = {
      rep: '#d84a4a',
      dem: '#2e74d7',
      independent: '#4CAF50',
      undecided: '#cccccc',
      noElection: '#f9f9f9'
    };

    // Seats contested in the 2026 cycle
    // Class II seats plus the special elections in Florida and Ohio
    const contestedStates = new Set([
      'AL','AK','AR','IA','KS','KY','LA','ME','MS','MT','NC','NE','OK','SC','SD','TN','TX','WV','WY','ID',
      'FL','OH', // special elections
      'CO','DE','IL','MA','MI','MN','NH','NJ','NM','OR','RI','VA','GA'
    ]);

    // seatData maps each state abbreviation to the number of Senate seats contested in 2026
    const seatData = {};
    // We'll fill seatData once we load the SVG and know all states

    // Tracks the current party assignment for each state
    const stateColors = {};
    let selectedParty = 'undecided';

    // Highlight the selected party button
    function highlightSelectedParty() {
      document.querySelectorAll('.party-button').forEach(btn => {
        if (btn.dataset.party === selectedParty) {
          btn.style.outline = '3px solid white';
        } else {
          btn.style.outline = 'none';
        }
      });
    }

    // Update the seat counts and bar widths
    function updateSeats() {
      let dem = 0, rep = 0, ind = 0, undecided = 0;
      const total = Object.values(seatData).reduce((a,b) => a + b, 0);
      for (const state of Object.keys(seatData)) {
        if (seatData[state] === 0) continue; // skip states with no election
        const party = stateColors[state] || 'undecided';
        if (party === 'dem') dem += 1;
        else if (party === 'rep') rep += 1;
        else if (party === 'independent') ind += 1;
        else undecided += 1;
      }
      document.getElementById('dem-seats').innerText = `Democrat: ${dem}`;
      document.getElementById('rep-seats').innerText = `Republican: ${rep}`;
      document.getElementById('ind-seats').innerText = `Independent: ${ind}`;
      document.getElementById('und-seats').innerText = `Undecided: ${undecided}`;
      const percent = x => total > 0 ? (x / total) * 100 : 0;
      document.getElementById('bar-dem').style.width = percent(dem) + '%';
      document.getElementById('bar-rep').style.width = percent(rep) + '%';
      document.getElementById('bar-ind').style.width = percent(ind) + '%';
      document.getElementById('bar-und').style.width = percent(undecided) + '%';
    }

    // Demographics dataset (simplified; ranks from the presidential map)
    const demographics = {
      AL: { Age: 40, Education: 47, Income: 45 },
      AK: { Age: 12, Education: 31, Income: 7 },
      AZ: { Age: 11, Education: 30, Income: 38 },
      AR: { Age: 42, Education: 49, Income: 48 },
      CA: { Age: 35, Education: 15, Income: 6 },
      CO: { Age: 25, Education: 2, Income: 9 },
      CT: { Age: 6, Education: 4, Income: 3 },
      DE: { Age: 26, Education: 17, Income: 16 },
      FL: { Age: 5, Education: 36, Income: 27 },
      GA: { Age: 18, Education: 33, Income: 34 },
      HI: { Age: 9, Education: 18, Income: 4 },
      ID: { Age: 20, Education: 39, Income: 40 },
      IL: { Age: 22, Education: 21, Income: 15 },
      IN: { Age: 34, Education: 43, Income: 35 },
      IA: { Age: 28, Education: 14, Income: 25 },
      KS: { Age: 27, Education: 23, Income: 30 },
      KY: { Age: 44, Education: 45, Income: 44 },
      LA: { Age: 43, Education: 50, Income: 50 },
      ME: { Age: 1, Education: 16, Income: 28 },
      MD: { Age: 13, Education: 5, Income: 1 },
      MA: { Age: 8, Education: 1, Income: 2 },
      MI: { Age: 29, Education: 25, Income: 32 },
      MN: { Age: 21, Education: 6, Income: 11 },
      MS: { Age: 48, Education: 48, Income: 49 },
      MO: { Age: 33, Education: 37, Income: 36 },
      MT: { Age: 10, Education: 34, Income: 33 },
      NE: { Age: 30, Education: 22, Income: 23 },
      NV: { Age: 14, Education: 44, Income: 31 },
      NH: { Age: 4, Education: 3, Income: 8 },
      NJ: { Age: 16, Education: 8, Income: 5 },
      NM: { Age: 32, Education: 42, Income: 46 },
      NY: { Age: 24, Education: 7, Income: 14 },
      NC: { Age: 23, Education: 35, Income: 37 },
      ND: { Age: 38, Education: 24, Income: 24 },
      OH: { Age: 31, Education: 29, Income: 29 },
      OK: { Age: 36, Education: 46, Income: 41 },
      OR: { Age: 7, Education: 12, Income: 22 },
      PA: { Age: 15, Education: 19, Income: 21 },
      RI: { Age: 17, Education: 9, Income: 17 },
      SC: { Age: 39, Education: 41, Income: 42 },
      SD: { Age: 45, Education: 40, Income: 39 },
      TN: { Age: 46, Education: 38, Income: 43 },
      TX: { Age: 37, Education: 32, Income: 26 },
      UT: { Age: 19, Education: 28, Income: 18 },
      VT: { Age: 3, Education: 10, Income: 12 },
      VA: { Age: 14, Education: 11, Income: 10 },
      WA: { Age: 2, Education: 13, Income: 19 },
      WV: { Age: 50, Education: 50, Income: 47 },
      WI: { Age: 31, Education: 20, Income: 20 },
      WY: { Age: 41, Education: 36, Income: 45 }
    };

    // Display demographic info for a given state
    function updateDemographics(state) {
      const info = demographics[state];
      const contentDiv = document.getElementById('demo-content');
      if (!info) {
        contentDiv.innerHTML = 'No demographic data available.';
        return;
      }
      contentDiv.innerHTML = `
        <strong>${state}</strong><br>
        Age rank: ${info.Age}<br>
        Education rank: ${info.Education}<br>
        Income rank: ${info.Income}
      `;
    }

    // Reset all contested states to undecided
    function resetMap() {
      Object.keys(stateColors).forEach(state => {
        const el = document.getElementById(state);
        if (!el) return;
        if (seatData[state] > 0) {
          stateColors[state] = 'undecided';
          el.style.fill = colors.undecided;
        } else {
          stateColors[state] = 'noElection';
          el.style.fill = colors.noElection;
        }
      });
      updateSeats();
      localStorage.removeItem('senateMapState');
    }

    // Save current map state to localStorage
    function saveMapState() {
      localStorage.setItem('senateMapState', JSON.stringify(stateColors));
      alert('Map state saved!');
    }

    // Load map state from localStorage
    function loadMapState() {
      const saved = JSON.parse(localStorage.getItem('senateMapState'));
      if (saved) {
        Object.entries(saved).forEach(([state, party]) => {
          const el = document.getElementById(state);
          if (el && colors[party]) {
            stateColors[state] = party;
            el.style.fill = colors[party];
          }
        });
        updateSeats();
        alert('Map state loaded!');
      }
    }

    // Export the current map view as a PNG
    function exportMap() {
      html2canvas(document.querySelector('.map-container')).then(canvas => {
        const link = document.createElement('a');
        link.download = 'senate-map.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    window.addEventListener('load', () => {
      // Set up party button handlers
      document.querySelectorAll('.party-button').forEach(btn => {
        btn.addEventListener('click', () => {
          selectedParty = btn.dataset.party;
          highlightSelectedParty();
        });
      });
      highlightSelectedParty();

      const tooltip = document.getElementById('tooltip');

      // Fetch the SVG map from the current directory and insert it into the page
      fetch('us.svg')
        .then(resp => resp.text())
        .then(svgText => {
          document.getElementById('us-map').innerHTML = svgText;
          // After inserting the SVG, initialise seatData and attach event listeners
          const svgElement = document.querySelector('#us-map svg');
          // Build seatData: contested states get 1, others 0
          const paths = svgElement.querySelectorAll('path');
          paths.forEach(path => {
            const state = path.id;
            if (!state) return;
            seatData[state] = contestedStates.has(state) ? 1 : 0;
            // Initialize colours: contested states start undecided; others noElection
            if (seatData[state] > 0) {
              stateColors[state] = 'undecided';
              path.style.fill = colors.undecided;
            } else {
              stateColors[state] = 'noElection';
              path.style.fill = colors.noElection;
            }
            // Add click handler only for contested states
            if (seatData[state] > 0) {
              path.addEventListener('click', () => {
                stateColors[state] = selectedParty;
                path.style.fill = colors[selectedParty];
                updateSeats();
                updateDemographics(state);
              });
            }
            // Tooltip show/hide
            path.addEventListener('mousemove', e => {
              tooltip.style.display = 'block';
              tooltip.style.left = (e.pageX + 10) + 'px';
              tooltip.style.top = (e.pageY + 10) + 'px';
              if (seatData[state] > 0) {
                tooltip.innerHTML = `${state} (1 seat)`;
              } else {
                tooltip.innerHTML = `${state} (no 2026 election)`;
              }
            });
            path.addEventListener('mouseleave', () => {
              tooltip.style.display = 'none';
            });
          });
          // Update totals after load
          updateSeats();
        });
    });
  </script>
</body>
</html>